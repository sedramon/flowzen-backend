# ü§ñ OpenRouter Setup Guide - Besplatni AI za DM generisanje

**Datum:** 16. oktobar 2025.  
**Verzija:** 1.0

---

## üéØ CILJ

Koristiti OpenRouter API sa **besplatnim** AI modelima za generisanje personalizovanih Instagram DM poruka.

---

## üÜì BESPLATNI MODELI (2025)

| Model | Provider | Cena | Context | Kvalitet | Brzina |
|-------|----------|------|---------|----------|--------|
| **meta-llama/llama-3.2-3b-instruct:free** | Meta | $0 | 8K | ‚≠ê‚≠ê‚≠ê‚≠ê | Brz |
| **google/gemma-2-9b-it:free** | Google | $0 | 8K | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | Srednji |
| **microsoft/phi-3-mini-128k-instruct:free** | Microsoft | $0 | 128K | ‚≠ê‚≠ê‚≠ê | Vrlo brz |
| **qwen/qwen-2-7b-instruct:free** | Alibaba | $0 | 32K | ‚≠ê‚≠ê‚≠ê‚≠ê | Brz |
| **mistralai/mistral-7b-instruct:free** | Mistral | $0 | 8K | ‚≠ê‚≠ê‚≠ê‚≠ê | Brz |

**Preporuka:** `google/gemma-2-9b-it:free` - najbolji balans kvaliteta i brzine

---

## üìù ACCOUNT SETUP

### 1. Registracija

1. Idi na https://openrouter.ai
2. Klikni "Sign In" ‚Üí "Sign up with Google/GitHub"
3. Potvrdi email
4. Dashboard: https://openrouter.ai/dashboard

### 2. API Key

1. U dashboardu ‚Üí "Keys" tab
2. Klikni "Create Key"
3. **Name:** `Make.com - Instagram DM`
4. **Limit:** Unlimited (free models nemaju cost)
5. **Scope:** Full access
6. Kopiraj API key (poƒçinje sa `sk-or-v1-...`)

**‚ö†Ô∏è ƒåUVAJ SIGURNO:** 
- Ne deli key ni sa kim
- Ne commit-uj u Git
- Koristi environment variables

### 3. Site Settings (Opciono)

1. "Settings" tab ‚Üí "Your Site"
2. **Site URL:** `https://saveyourtime.rs`
3. **Site Name:** `BexExpress DM Generator`

Ovo omoguƒáava bolje ranking na OpenRouter leaderboard-u.

---

## üîå MAKE.COM INTEGRATION

### HTTP Module Setup

**Module:** HTTP ‚Üí Make a Request

#### Konfiguracija:

**URL:**
```
https://openrouter.ai/api/v1/chat/completions
```

**Method:** `POST`

**Headers:**
```json
{
  "Authorization": "Bearer {{env.OPENROUTER_API_KEY}}",
  "Content-Type": "application/json",
  "HTTP-Referer": "https://saveyourtime.rs",
  "X-Title": "BexExpress Instagram DM Generator"
}
```

**Body Type:** Raw (JSON)

**Body:**
```json
{
  "model": "google/gemma-2-9b-it:free",
  "messages": [
    {
      "role": "system",
      "content": "Ti si AI asistent koji generi≈°e prirodne, personalizovane Instagram DM poruke na srpskom jeziku. Poruke treba da budu prijateljske, kratke (max 140 karaktera), bez spam-a, i prilagoƒëene profilu primaoca. Cilj je poziv na poslovnu saradnju sa @SaveYourTime platformom."
    },
    {
      "role": "user",
      "content": "Generi≈°i DM poruku za Instagram shop profil:\n\nUsername: @{{username}}\nBio: {{bio}}\nFollowers: {{followers}}\n\nPoruka treba da:\n- Pozove na saradnju sa @SaveYourTime\n- Spomene specifiƒçan detalj iz njihovog profila\n- Bude max 140 karaktera\n- Zvuƒçi prirodno i ljudski (ne kao bot)\n- Ne koristi previ≈°e emoji\n\nSamo napi≈°i poruku, bez dodatnih obja≈°njenja."
    }
  ],
  "max_tokens": 150,
  "temperature": 0.8,
  "top_p": 0.9,
  "frequency_penalty": 0.3,
  "presence_penalty": 0.3
}
```

#### Response Parsing:

**Parse response:** ‚úÖ Yes

**Output:**
```
Generated Message: {{1.choices[0].message.content}}
```

**Error Handling:**
```
If status ‚â† 200:
  Fallback to default template
```

---

## üé® PROMPT ENGINEERING

### System Prompt (optimizovan za DM-ove):

```
Ti si AI asistent koji generi≈°e personalizovane Instagram DM poruke za poslovnu saradnju.

PRAVILA:
1. Pi≈°i na srpskom jeziku (latinica)
2. Max 140 karaktera po poruci
3. Ton: prijateljski ali profesionalan
4. Obavezno pomeni specifiƒçan detalj iz profila (bio/username)
5. Poziv na akciju: ponudi besplatnu demo platforme
6. NE koristi:
   - Generiƒçke fraze ("samo da vas kontaktiram")
   - Spam kljuƒçne reƒçi ("super ponuda", "ne propustite")
   - Previ≈°e emoji (max 1-2)
   - Formalan jezik ("Po≈°tovani", "s po≈°tovanjem")

STRUKTURA PORUKE:
[Personalizovani uvod] + [Vrednost koju nudimo] + [Poziv na akciju]

PRIMERI DOBRIH PORUKA:
- "Videla sam tvoje divne handmade narukvice! üé® @SaveYourTime mo≈æe da ti pomogne sa online prodajom - besplatna demo?"
- "Super Instagram profil! Tvoj shop bi mogao da ima vi≈°e kupaca uz na≈°u platformu. Da razgovaramo?"
- "Pratim tvoj rad, sviƒëa mi se! @SaveYourTime nudi besplatnu prodavnicu - da ti poka≈æem kako radi?"
```

### User Prompt Template:

```
Generi≈°i DM poruku za:

Username: @{{username}}
Bio: {{bio}}
Followers: {{followers}}
Hashtags: {{hashtags}}

Kontekst: Ovaj profil je Instagram shop. ≈Ωelimo da ponudimo saradnju sa @SaveYourTime platformom koja poma≈æe malim biznisima da prodaju online.

Samo napi≈°i poruku (max 140 karaktera), bez dodatnog teksta.
```

### Advanced: Category-based prompts

**Za handmade shops:**
```
Dodatni kontekst: Profil prodaje handmade proizvode. 
Fokus: kreativnost, unikatnost, podr≈°ka lokalnim umetnicima.
Ton: topliji, vi≈°e emoji.
```

**Za fashion shops:**
```
Dodatni kontekst: Fashion/clothing shop.
Fokus: styling, trendovi, moderni brending.
Ton: urbani, modern.
```

**Za food/beverage:**
```
Dodatni kontekst: Prodaja hrane/piƒáa.
Fokus: kvalitet, domaƒái proizvodi, dostava.
Ton: srdaƒçan, porodiƒçan.
```

---

## üß™ TESTIRANJE

### Test 1: Simple Request

**cURL test:**
```bash
curl https://openrouter.ai/api/v1/chat/completions \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -H "HTTP-Referer: https://saveyourtime.rs" \
  -d '{
    "model": "google/gemma-2-9b-it:free",
    "messages": [
      {
        "role": "user",
        "content": "Napi≈°i kratku Instagram DM poruku (max 140 karaktera) za shop koji prodaje handmade nakit. Pozovi ih na saradnju sa @SaveYourTime platformom."
      }
    ],
    "max_tokens": 150
  }'
```

**Expected response:**
```json
{
  "id": "gen-xxxxx",
  "model": "google/gemma-2-9b-it:free",
  "choices": [{
    "message": {
      "role": "assistant",
      "content": "Pozdrav! Tvoj handmade nakit je prelep! üé® @SaveYourTime mo≈æe da ti pomogne da stigne≈° do vi≈°e kupaca. Besplatna demo?"
    },
    "finish_reason": "stop"
  }],
  "usage": {
    "prompt_tokens": 45,
    "completion_tokens": 32,
    "total_tokens": 77
  }
}
```

### Test 2: Make.com HTTP Module

**Manual run u Make.com:**

1. Kreiraj test scenario sa samo HTTP modulom
2. Koristi hardcoded vrednosti:
   ```
   username: handmade_jewelry_bg
   bio: üé® Handmade nakit | Beograd | Naruƒçivanje u DM
   followers: 850
   ```
3. Run module
4. Proveri output:
   - Da li je poruka na srpskom?
   - Da li je < 140 karaktera?
   - Da li ima smisla?
   - Da li pominje specifiƒçan detalj?

### Test 3: Error Handling

**Test scenariji:**

**Invalid API Key:**
```
Expected: 401 Unauthorized
Action: Fallback to default message
```

**Model not found:**
```
Expected: 404 Not Found  
Action: Switch to backup model (mistralai/mistral-7b-instruct:free)
```

**Rate limit (shouldn't happen sa free models):**
```
Expected: 429 Too Many Requests
Action: Wait 60s and retry
```

---

## üìä MODEL COMPARISON

**Test sa istim promptom:**

### Test Prompt:
```
Username: @vintage_fashion_bg
Bio: Vintage odeƒáa | Retro stil | Beograd
Followers: 1200

Generi≈°i DM poruku (max 140 karaktera).
```

### Rezultati:

**google/gemma-2-9b-it:free** (NAJBOLJI):
```
"Vintage kolekcija ti je üî•! @SaveYourTime bi ti pomogao da stigne≈° do vi≈°e ljubitelja retro stila. Da priƒçamo?"
```
‚úÖ Prirodno, specifiƒçno, poziv na akciju

**meta-llama/llama-3.2-3b-instruct:free**:
```
"Pozdrav! Vidim da ima≈° super vintage shop. Da li bi ≈æelela saradnju sa platformom za online prodaju? üòä"
```
‚ö†Ô∏è Dobro, ali malo generiƒçno

**microsoft/phi-3-mini-128k-instruct:free**:
```
"Cao! Tvoj vintage stil je odliƒçan. Nudimo platformu za lak≈°u prodaju - besplatno! Zainteresovana?"
```
‚ö†Ô∏è OK, ali manje personalizovano

**Konaƒçna preporuka:** `google/gemma-2-9b-it:free`

---

## üîÑ FALLBACK STRATEGY

### Primary ‚Üí Backup chain:

```
1. google/gemma-2-9b-it:free (primary)
   ‚Üì (if fails)
2. meta-llama/llama-3.2-3b-instruct:free (backup 1)
   ‚Üì (if fails)
3. Default template (last resort)
```

### Make.com Error Handler:

**Module:** Error Handler (na HTTP modulu)

**Fallback logic:**
```javascript
if (error.status = 404 OR error.status = 503) {
  // Model unavailable, use backup
  model = "meta-llama/llama-3.2-3b-instruct:free"
  retry()
} else if (error.status = 401) {
  // API key issue, use default template
  message = generateDefaultMessage(username, bio)
} else {
  // Unknown error, log and use default
  logError(error)
  message = "Pozdrav! Videli smo va≈° Instagram shop i zainteresovani smo za saradnju sa @SaveYourTime platformom. Da li biste ≈æeleli besplatnu demo? üöÄ"
}
```

---

## üí° OPTIMIZACIJE

### A/B Testing Prompts:

**Variant A (Friendly):**
```
Ton: casual, prijateljski
Emoji: 1-2
Fokus: zajednica, podr≈°ka
```

**Variant B (Professional):**
```
Ton: profesionalan ali topao
Emoji: max 1
Fokus: rast biznisa, rezultati
```

**Variant C (Direct):**
```
Ton: direktan, value-focused
Emoji: 0
Fokus: konkretna ponuda
```

**Tracking:**
- Dodaj `variant` field u Airtable
- Track reply rate per variant
- Auto-optimize to best performer

### Dynamic Temperature:

```javascript
// Za veƒáe shopove - profesionalniji ton
if (followers > 2000) {
  temperature = 0.6  // Less creative, more professional
} else {
  temperature = 0.8  // More creative, friendly
}
```

### Personalization Levels:

**Level 1 (Basic):**
```
Username + Bio + Generic offer
```

**Level 2 (Advanced):**
```
Username + Bio + Followers + Category detection + Tailored message
```

**Level 3 (Premium):**
```
Username + Bio + Latest posts + Product type + Competitor analysis + Hyper-personalized
```

---

## üìà MONITORING

### OpenRouter Dashboard:

**Metrics to track:**
1. **Total requests** - koliko AI poziva dnevno
2. **Average latency** - brzina odgovora
3. **Error rate** - procenat neuspelih poziva
4. **Model performance** - koji model daje najbolje rezultate

### Make.com Logging:

**Log structure:**
```json
{
  "timestamp": "2025-10-16 14:30:22",
  "username": "@handmade_serbia",
  "model_used": "google/gemma-2-9b-it:free",
  "prompt_tokens": 85,
  "completion_tokens": 42,
  "latency_ms": 1250,
  "generated_message": "...",
  "success": true
}
```

---

## üö® TROUBLESHOOTING

### Problem: Poruke su preduguaƒçke (>140 karaktera)

**Re≈°enje:**
```javascript
// U Make.com, dodaj Text Parser module posle HTTP
if (length(message) > 140) {
  message = truncate(message, 137) + "..."
}
```

**Bolji pristup - u promptu:**
```
KRITIƒåNO: Poruka MORA biti max 140 karaktera. Nemoj prekoraƒçiti!
```

### Problem: Poruke zvuƒçe previ≈°e AI/bot-like

**Re≈°enje - pobolj≈°aj prompt:**
```
Dodatna pravila:
- Ne koristi fraze: "≈æeleli bismo", "obratite nam se", "kontaktirajte nas"
- Koristi naturalne izraze: "da priƒçamo?", "zainteresovana?", "da ti poka≈æem?"
- Pi≈°i kao da ≈°alje≈° poruku prijatelju
```

### Problem: Poruke nisu na srpskom (latinica)

**Re≈°enje:**
```
System prompt dodaj:
"OBAVEZNO pi≈°i na srpskom jeziku koristeƒái latinicu (ne ƒáirilicu). Primeri: 'ƒá' ne '—õ', '≈°' ne '—à'."
```

### Problem: Model vraƒáa praznu poruku

**Re≈°enje:**
```javascript
// Validation u Make.com
if (isEmpty(message) OR message.length < 10) {
  message = getDefaultTemplate(username)
}
```

---

## üîë ENVIRONMENT VARIABLES

### Make.com Organization Settings:

```
Variable name: OPENROUTER_API_KEY
Value: sk-or-v1-xxxxxxxxxxxxxxxxxx
Type: Secret (encrypted)
Description: OpenRouter API key for free AI models
```

**Access u modulima:**
```
{{env.OPENROUTER_API_KEY}}
```

---

## üìö DODATNI RESURSI

- OpenRouter Docs: https://openrouter.ai/docs
- Model Comparison: https://openrouter.ai/rankings
- Free Models List: https://openrouter.ai/models?order=newest&pricing=free
- Discord Community: https://discord.gg/openrouter

---

## ‚úÖ FINAL CHECKLIST

- [ ] OpenRouter nalog kreiran
- [ ] API Key generisan i saƒçuvan
- [ ] Site settings konfigurisani
- [ ] Test HTTP request uspe≈°an (cURL)
- [ ] Make.com modul konfigurisan
- [ ] System prompt optimizovan
- [ ] Error handling pode≈°en
- [ ] Fallback strategija implementirana
- [ ] A/B testing variants pripremirani
- [ ] Environment variable saƒçuvan u Make.com

---

**Prev:** [Airtable Setup Guide](./Airtable-Setup-Guide.md)  
**Next:** [Apify Setup Guide](./Apify-Setup-Guide.md)

